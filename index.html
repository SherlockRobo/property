<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™æ¸¯æˆ¿äº§æŠ•èµ„/è‡ªä½è®¡ç®—å™¨</title>
    <!-- å¼•å…¥ Tailwind CSS ç”¨äºæ ·å¼ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- å¼•å…¥ Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å¼•å…¥ Lucide å›¾æ ‡ -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .input-group { margin-bottom: 1rem; }
        .input-label { display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem; }
        .input-field { width: 100%; border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.5rem; font-size: 0.875rem; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- æ¨¡æ‹Ÿ UI ç»„ä»¶ ---
        const Card = ({ children, className = "" }) => <div className={`bg-white rounded-lg border shadow-sm ${className}`}>{children}</div>;
        
        // --- æ ¸å¿ƒè®¡ç®—å™¨ç»„ä»¶ ---
        function HKPropertyCalculator() {
            // 1. è¾“å…¥çŠ¶æ€ç®¡ç†
            const [inputs, setInputs] = useState({
                price: 8000000,          // æˆ¿ä»·
                area: 500,               // å°ºæ•°
                monthlyMarketRent: 20000,// å¸‚åœºç§Ÿé‡‘
                monthlyMgmtFee: 1500,    // ç®¡ç†è´¹
                mortgageRate: 4.125,     // åˆ©ç‡ %
                loanPercent: 90,         // æŒ‰æ­æˆæ•° %
                years: 30,               // å¹´é™
                usageMode: 'self',       // 'rent' (å‡ºç§Ÿ) æˆ– 'self' (è‡ªä½)
                usePersonalAssessment: false // æ˜¯å¦ä½¿ç”¨ä¸ªäººå…¥æ¯è¯¾ç¨
            });

            // 2. æ ¸å¿ƒè®¡ç®—é€»è¾‘ (å¤åˆ»æˆªå›¾ä¸­çš„é€»è¾‘)
            const results = useMemo(() => {
                const { price, monthlyMarketRent, monthlyMgmtFee, mortgageRate, years, usageMode, loanPercent } = inputs;
                
                // åŸºç¡€æ•°æ®
                const annualMarketRent = monthlyMarketRent * 12;
                const downPayment = price * (1 - loanPercent / 100);
                const loanAmount = price * (loanPercent / 100);
                
                // ç®€åŒ–çš„å°èŠ±ç¨è®¡ç®— (Scale 2 ä¼°ç®—)
                let stampDuty = 0;
                if (price <= 3000000) stampDuty = 100;
                else if (price <= 3528240) stampDuty = 100 + (price - 3000000) * 0.1; // è¿™é‡Œçš„å…¬å¼ä»…ä¸ºç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…éœ€æŒ‰æœ€æ–°ç¨è¡¨
                else if (price <= 4500000) stampDuty = price * 0.015;
                else if (price <= 6000000) stampDuty = price * 0.0225;
                else if (price <= 9000000) stampDuty = price * 0.03;
                else if (price <= 20000000) stampDuty = price * 0.0375;
                else stampDuty = price * 0.0425;

                // åˆå§‹æ”¯å‡º
                const agencyFee = price * 0.01; // 1% ä½£é‡‘
                const legalFee = 10000; // ä¼°ç®—å¾‹å¸ˆè´¹
                const initialCashOut = downPayment + stampDuty + agencyFee + legalFee;

                // æŒ‰æ­è®¡ç®— (æœˆä¾›)
                const r = mortgageRate / 100 / 12;
                const n = years * 12;
                const monthlyPayment = loanAmount > 0 ? (loanAmount * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1) : 0;
                const annualPayment = monthlyPayment * 12;

                // ç¬¬ä¸€å¹´åˆ©æ¯ (ä¼°ç®—)
                const totalInterest1stYear = loanAmount * (mortgageRate / 100); 
                // æ³¨æ„ï¼šå®é™…åˆ©æ¯æ˜¯é€æœˆé€’å‡çš„ï¼Œè¿™é‡Œä¸ºäº†ç®€åŒ–é€»è¾‘å–é¦–å¹´è¿‘ä¼¼å€¼ï¼Œæˆ–ä½ å¯ä»¥å†™æ›´å¤æ‚çš„ amortization
                
                // æ‚è´¹ (å·®é¥·åœ°ç§Ÿä¼°ç®—ä¸ºç§Ÿå€¼çš„5%)
                const ratesYear = annualMarketRent * 0.05; 
                const mgmtFeeYear = monthlyMgmtFee * 12;

                // --- ç¨åŠ¡ä¸æ ¸å¿ƒé€»è¾‘ (ä½ æˆªå›¾é‡Œçš„é‡ç‚¹) ---
                let propertyTax = 0;
                let salaryTaxSave = 0;

                if (usageMode === 'rent') {
                    // å‡ºç§Ÿæ¨¡å¼ï¼šè®¡ç®—ç‰©ä¸šç¨
                    const assessableValue = Math.max(0, annualMarketRent - ratesYear); // æ‰£é™¤å·®é¥·
                    const netAssessableValue = assessableValue * 0.8; // 20% ä¿®ç¼®å…ç¨é¢
                    propertyTax = netAssessableValue * 0.15; // 15% ç‰©ä¸šç¨
                } else {
                    // è‡ªä½æ¨¡å¼ï¼šè®¡ç®—åˆ©æ¯æŠµæ‰£çœä¸‹çš„ç¨
                    // å‡è®¾æœ€é«˜æ‰£é™¤ 100,000
                    const deductibleInterest = Math.min(totalInterest1stYear, 100000);
                    salaryTaxSave = deductibleInterest * 0.15; // å‡è®¾è¾¹é™…ç¨ç‡ 15%
                }

                const holdingCost = ratesYear + mgmtFeeYear + propertyTax; // æŒæœ‰æˆæœ¬
                
                // çœŸå®å±…ä½æˆæœ¬ (Burn Rate)
                // å…¬å¼ï¼šåˆ©æ¯ + æŒæœ‰æ‚è´¹ - çœä¸‹çš„ç¨
                const true_living_cost_year = totalInterest1stYear + holdingCost - salaryTaxSave;
                const true_living_cost_month = true_living_cost_year / 12;

                // ç°é‡‘æµå‡º
                const cash_outflow_monthly = monthlyPayment + monthlyMgmtFee + (ratesYear / 12);

                // ä¹°æˆ¿ vs ç§Ÿæˆ¿ èŠ‚çœé‡‘é¢
                // å¦‚æœæˆ‘ä¸ä¹°ï¼Œæˆ‘å°±è¦ä»˜ annualMarketRentã€‚ä¹°äº†ä¹‹åï¼Œæˆ‘çš„çœŸå®æ¶ˆè€—æ˜¯ true_living_cost_yearã€‚
                const save_vs_renting_year = annualMarketRent - true_living_cost_year;
                const save_vs_renting_month = save_vs_renting_year / 12;

                return {
                    price,
                    initialCashOut,
                    monthlyPayment,
                    true_living_cost_month,
                    save_vs_renting_month,
                    save_vs_renting_year,
                    cash_outflow_monthly,
                    stampDuty
                };
            }, [inputs]);

            // æ ¼å¼åŒ–é‡‘é¢
            const formatMoney = (val) => val?.toLocaleString('en-US', { maximumFractionDigits: 0 });

            return (
                <div className="max-w-5xl mx-auto space-y-6">
                    <header className="flex items-center gap-2 mb-6">
                        <h1 className="text-2xl font-bold text-slate-800">ğŸ‡­ğŸ‡° é¦™æ¸¯æˆ¿äº§è®¡ç®—å™¨ (ä¿®å¤ç‰ˆ)</h1>
                    </header>

                    <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
                        {/* å·¦ä¾§ï¼šè¾“å…¥åŒºåŸŸ (å  5/12) */}
                        <div className="md:col-span-5 space-y-4">
                            <Card className="p-4 space-y-4">
                                {/* æ¨¡å¼é€‰æ‹© */}
                                <div className="grid grid-cols-2 gap-2 bg-slate-100 p-1 rounded-lg">
                                    <button 
                                        onClick={() => setInputs({...inputs, usageMode: 'rent'})}
                                        className={`py-2 text-sm font-medium rounded-md transition-all ${inputs.usageMode === 'rent' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                    >
                                        å‡ºç§ŸæŠ•èµ„ (Rent)
                                    </button>
                                    <button 
                                        onClick={() => setInputs({...inputs, usageMode: 'self'})}
                                        className={`py-2 text-sm font-medium rounded-md transition-all ${inputs.usageMode === 'self' ? 'bg-white text-orange-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                    >
                                        è‡ªä½ (Self)
                                    </button>
                                </div>

                                {/* æ ¸å¿ƒè¾“å…¥ */}
                                <div>
                                    <label className="input-label">æˆ¿ä»· (HKD)</label>
                                    <input 
                                        type="number" 
                                        className="input-field"
                                        value={inputs.price}
                                        onChange={e => setInputs({...inputs, price: Number(e.target.value)})}
                                    />
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="input-label">æŒ‰æ­æˆæ•° (%)</label>
                                        <input 
                                            type="number" 
                                            className="input-field"
                                            value={inputs.loanPercent}
                                            onChange={e => setInputs({...inputs, loanPercent: Number(e.target.value)})}
                                        />
                                    </div>
                                    <div>
                                        <label className="input-label">å¹´åˆ©ç‡ (%)</label>
                                        <input 
                                            type="number" 
                                            className="input-field"
                                            value={inputs.mortgageRate}
                                            onChange={e => setInputs({...inputs, mortgageRate: Number(e.target.value)})}
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="input-label">{inputs.usageMode === 'rent' ? 'é¢„è®¡ç§Ÿé‡‘æ”¶å…¥' : 'åŒç±»æˆ¿æºå¸‚åœºç§Ÿé‡‘'} (HKD)</label>
                                    <input 
                                        type="number" 
                                        className="input-field"
                                        value={inputs.monthlyMarketRent}
                                        onChange={e => setInputs({...inputs, monthlyMarketRent: Number(e.target.value)})}
                                    />
                                </div>

                                <div>
                                    <label className="input-label">æœˆç®¡ç†è´¹ (HKD)</label>
                                    <input 
                                        type="number" 
                                        className="input-field"
                                        value={inputs.monthlyMgmtFee}
                                        onChange={e => setInputs({...inputs, monthlyMgmtFee: Number(e.target.value)})}
                                    />
                                </div>
                            </Card>
                        </div>

                        {/* å³ä¾§ï¼šç»“æœåŒºåŸŸ (å  7/12) */}
                        <div className="md:col-span-7 space-y-4">
                            {/* ä½ çš„æˆªå›¾ä¸­çš„æ©™è‰²/è“è‰²ç»“æœå¡ç‰‡ */}
                            <div className={`p-4 rounded-lg border grid grid-cols-2 gap-4 ${inputs.usageMode === 'self' ? 'bg-orange-50 border-orange-100' : 'bg-blue-50 border-blue-100'}`}>
                                <div>
                                    <div className={`text-xs font-medium mb-1 ${inputs.usageMode === 'self' ? 'text-orange-900' : 'text-blue-900'}`}>
                                        æ¯æœˆèŠ‚çœ (ç›¸æ¯”ç§Ÿæˆ¿)
                                    </div>
                                    <div className={`text-2xl font-bold ${inputs.usageMode === 'self' ? 'text-orange-700' : 'text-blue-700'}`}>
                                        {results.save_vs_renting_month > 0 ? '+' : ''}${formatMoney(results.save_vs_renting_month)}
                                    </div>
                                </div>
                                <div className={`pl-4 border-l ${inputs.usageMode === 'self' ? 'border-orange-200' : 'border-blue-200'}`}>
                                    <div className={`text-xs font-medium mb-1 ${inputs.usageMode === 'self' ? 'text-orange-900' : 'text-blue-900'}`}>
                                        æ¯å¹´ç´¯ç§¯èŠ‚çœ
                                    </div>
                                    <div className={`text-2xl font-bold ${inputs.usageMode === 'self' ? 'text-orange-700' : 'text-blue-700'}`}>
                                        {results.save_vs_renting_year > 0 ? '+' : ''}${formatMoney(results.save_vs_renting_year)}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="text-[10px] text-slate-400 text-right">
                                * æ­£æ•°ä»£è¡¨ä¹°æˆ¿æ¯”ç§Ÿæˆ¿å¤šæ”’ä¸‹çš„å‡€èµ„äº§ï¼ˆå·²æ‰£é™¤åˆ©æ¯æ¶ˆè€—ï¼‰
                            </div>

                            {/* è¯¦ç»†æ•°æ®åˆ—è¡¨ */}
                            <Card className="divide-y divide-slate-100">
                                <div className="p-3 flex justify-between items-center">
                                    <span className="text-sm text-slate-600">é¦–æœŸæ”¯å‡º (å«å°èŠ±ç¨/ä½£é‡‘)</span>
                                    <span className="font-mono font-medium">${formatMoney(results.initialCashOut)}</span>
                                </div>
                                <div className="p-3 flex justify-between items-center">
                                    <span className="text-sm text-slate-600">æ¯æœˆä¾›æ¬¾ (æœ¬+æ¯)</span>
                                    <span className="font-mono font-medium">${formatMoney(results.monthlyPayment)}</span>
                                </div>
                                <div className="p-3 flex justify-between items-center bg-slate-50">
                                    <span className="text-sm text-slate-600">æ¯æœˆçœŸå®æ¶ˆè€— (åˆ©æ¯+æ‚è´¹-ç¨æƒ )</span>
                                    <span className="font-mono font-bold text-red-500">-${formatMoney(results.true_living_cost_month)}</span>
                                </div>
                                <div className="p-3 flex justify-between items-center opacity-75">
                                    <span className="text-sm text-slate-600">å¯¹æ¯”ï¼šå¸‚åœºç§Ÿé‡‘æ”¯å‡º</span>
                                    <span className="font-mono text-slate-900">-${formatMoney(inputs.monthlyMarketRent)}</span>
                                </div>
                            </Card>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HKPropertyCalculator />);
    </script>
</body>
</html>
